---
time: 2025-06-05
author: Fang
tags:
  - 有向无环图
  - 拓扑排序
  - AOV网
  - AOE网
  - 关键路径
---
# 学习目标
- [ ] 
- [ ] 

# 一、有向无环图相关概念
**有向无环图（DAG）是一种有向图**，但其中不存在从某个顶点出发沿有向边能回到自身的路径（即**不包含环路**）
通俗理解：图中所有边都有方向，且沿着方向走不会形成闭环
![[Pasted image 20250606190547.png]]
## 1.有向无环图的特性
- **有向性**：边具有方向（例如从A指向B）   
- **无环性**：不存在形如 A → B → C → A 的路径
- **可以进行拓扑排序**：DAG 是可以进行**拓扑排序**的图（这是一种线性排序，使得所有边 u → v 中，u 都出现在 v 之前）

由于其特性，我们常常使用它来描述一个工程或者系统的进行过程，一个工程可以分为若干个子工程，只要完成了子工程，就可以导致整个工程的完成
## 2.工程网络
### AOV网
用一个有向图来表示一个工程的各子工程及其相互制约的关系，其中以**顶点表示活动，弧表示活动之间的优先制约关系**，称这种有向图为顶点表示活动的网，简称**AOV**网（Activity On Vertex network）
### AOE网
用一个有向图来表示一个工程的各子工程及其相互制约的关系，其中以**弧表示活动，顶点表示活动的开始或结束事件**，称这种有向图为边表示活动的网，简称**AOE**网（Activity On Edge network）

>**AOV**网被用于拓扑排序，而**AOE**网被用于关键路径，下面来分别介绍两种问题

# 二、拓扑排序
## 1.AOV网的特点
- 若从i到j有一条有向路径，则i是j的前驱；j是i的后继
- 若<i,j>是网中有向边，则i是j的直接前驱，j是i的直接后继
- AOV网中不允许有回路，因为如果有回路存在，则表明某项活动以自己为先决条件，这显然不成立

*如何判断AOV网中是否有回路呢？*
我们可以使用拓扑序来解决这个问题
## 2.拓扑排序的概念
在AOV网没有回路的前提下，我们将全部活动排列成一个线性序列，使得若AOV网中有弧<i,j>存在，则在这个序列中，i一定在j前面，具有这种性质的线性序列叫做**拓扑有序序列，相应的拓扑有序排列算法叫做拓扑排序**
## 3.拓扑排序思路
1. 在有向无环图中选一个没有前驱的顶点并且输出
2. 将该顶点和它的出度边删除，再从剩余顶点中选择没有前驱的顶点并输出
3. 重复执行上面两步，直到不存在没有前驱的结点为止

*有如下的一个有向无环图结构*：
![[Pasted image 20250606192424.png|500]]
*算法实现步骤*：
1. 网结构中，没有前驱的顶点有1和9，我们选择1作为开头；将1加入序列，并删除顶点1和它的出度边
2. 目前，网结构中没有前驱的顶点有2、4、12、9；我们选择2，加入序列，并删除顶点2和它的出度边
3. 重复执行上述两步，最终我们可以得到一个这样的序列：1、2、3、4、5、7、9、10、11、6、8、12

>需要注意的是：**拓扑序列并不是唯一的，取决于网结构和选取顶点的顺序**，但是所有的拓扑序列中，一个顶点的前驱一定出现在该顶点之前

## 4.拓扑排序的应用
回到之前的问题：*如何判断AOV网中是否有回路呢？*

通过拓扑排序算法，我们可以看到：
- 若有向图中存在环形结构，则在拓扑排序算法中，它一定存在无法被删除的前驱，则一定不能加入拓扑序列中
- 所以，对于一个有向图，若**其所有顶点都在拓扑有序序列中，则该AOV网中必定不存在环**，也就是有向无环图
![[Pasted image 20250606193727.png|500]]
>如上图所示，对于这样一个网结构的拓扑有序序列中，必然不会出现3、5、8这三个顶点


# 三、关键路径
## 1.AOE网络
- 在AOE网结构中，我们用**弧表示活动，用顶点表示事件，弧的权值表示活动持续时间**
- 顶点的事件表示在它之前活动已经完成，在它之后活动可以开始

*有如下的活动表*：

| 活动  | 耗费时间 | 前置任务 |
| --- | ---- | ---- |
| A   | 30   | 无    |
| B   | 60   | A    |
| C   | 45   | A    |
| D   | 60   | B    |
| E   | 69   | B    |
| F   | 30   | DE   |
| G   | 15   | C    |
*我们可以得到如下的AOE网*：
![[Pasted image 20250606200815.png|550]]
## 2.关键路径的概念
对于AOE网，我们主要关心两个问题：
1. *完成整项工程需要多长时间？*
2. *哪些活动是影响工程进度的关键？*

由此，我们引出了两个关键概念：
- **路径长度**——路径上各活动持续时间之和
- **关键路径**——路径长度最长的路径
### 关键路径的描述量
为了确定关键路径，我们需要定义几个描述量：
- 对于每个顶点（事件），有：
	1. $ve(vj)$——表示事件vj的最早发生时间
	2. $vl(vj)$——表示事件vj的最迟发生时间
- 对于每个边（活动），有：
	1. $e(i)$——表示活动ai的最早开始时间
	2. $l(i)$——表示活动ai的最迟开始时间
	3. **时间余量**：$l(i)-e(i)$表示活动ai的时间余量

>  对于**时间余量为零的活动**，即$l(i)-e(i)==0$的活动，我们称其为关键路径上的活动，也就是关键活动，由**多个关键活动组成的路径，就是关键路径**

*怎么找寻关键活动呢？*
## 3.关键路径的计算
![[Pasted image 20250606203007.png|300]]
如上图所示：我们设活动ai用<j,k>表示，其持续时间记为$w_{j,k}$，则有：
$$\left\{
\begin{array}{l}
e(i) = ve(j) \\
l(i) = vl(k) - w_{j,k}
\end{array}
\right.$$
可以看到，关键路径的计算的**关键在于计算事件最早发生事件和最迟发生事件**
*如何求出ve(j)和vl(k)——即某事件最早发生时间和最晚发生时间呢？*

### 某事件最早发生时间
- 一个事件是多个前驱事件（活动）完成后的“汇合点”，它的最早发生时间，必须等待**所有前驱活动都完成**
- 从$Ve(起点)=0$开始向前推进，对图中所有活动 <j, k>，持续时间为$w_{j,k}$有：

$$ve(k) = \max_{j \in \text{pred}(k)} [ve(j) + w_{j,k}]$$
即：
> 某事件 k 的最早发生时间 = 所有前驱事件 j 的最早发生时间 + 活动 <j, k> 的耗时的最大值


### 某事件最迟发生时间
- 一个事件最晚能发生的时间，需要保证**不会耽误整个项目进度**；也就是说，从该事件出发的所有后续活动，**最早要开始的那一个，决定该事件最晚何时能发生**，否则就会"误工"
- 从$Vl(终点)=Ve(终点)$开始向后推进，对图中所有活动 <j, k>，持续时间为 $w_{j,k}$有：
$$vl(j)=\min_{k∈succ(j)}​[vl(k)−wj,k​]$$
即：
> 某事件 j 的最迟开始时间 = 所有后继事件 k 的最迟开始时间 - 活动 <j, k> 的耗时的最小值  

## 4.举例
*如下图的AOE网结构，求它的*：
1.  ve(i)、vl(j)；
2. e(i)、l(i)、l(i)-e(i)
3. 关键活动
![[Pasted image 20250606231917.png|550]]

*计算步骤*：
1. 我们根据公式可以求出ve(i)和vl(i),结果如下表：

| 顶点  | ve  | vl  |
| --- | --- | --- |
| 1   | 0   | 0   |
| 2   | 6   | 6   |
| 3   | 4   | 6   |
| 4   | 5   | 8   |
| 5   | 7   | 7   |
| 6   | 7   | 10  |
| 7   | 16  | 16  |
| 8   | 14  | 14  |
| 9   | 18  | 18  |
2. 我们获取了ve(i)和vl(i)，就能计算出e(i)、l(i)和l(i)-e(i)

| 活动  | e   | l   | l-e |
| --- | --- | --- | --- |
| a1  | 0   | 0   | 0   |
| a2  | 0   | 2   | 2   |
| a3  | 0   | 3   | 3   |
| a4  | 6   | 6   | 0   |
| a5  | 4   | 6   | 2   |
| a6  | 5   | 8   | 3   |
| a7  | 7   | 7   | 0   |
| a8  | 7   | 7   | 0   |
| a9  | 7   | 10  | 3   |
| a10 | 16  | 16  | 0   |
| a11 | 14  | 14  | 0   |

3. 由表可知，关键活动为：a1、a4、a7、a8、a10、a11

## 5.关键路径总结
![[Pasted image 20250606234344.png]]
1. 若网中有几条关键路径，则需要**加快同时在关键路径上的关键活动**
2. 如果一个活动处于所有的关键路径上，那么提高这个活动的速度，就能缩短整个工程完成的时间
3. 处于所有关键路径上的活动完成时间**不能缩短太多**，否则会使原来的关键路径变成非关键路径；这是就需要重新寻找关键路径

